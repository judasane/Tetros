<div class="flex flex-col items-center justify-center min-h-screen p-2 sm:p-4 bg-slate-900 text-sm">

  <!-- Game Wrapper - A row on all screen sizes, centered on the page -->
  <div class="flex flex-row gap-4 items-start">
  
    <!-- Left Column -->
    <div class="flex flex-col gap-4">
      
      <!-- Powerups Panel -->
      <div [style.width.px]="boardWidth()">
        <app-info-panel title="PowerUps">
            <div class="grid grid-cols-4 gap-2 text-center">
                <button (click)="game.activatePowerUp('laser')" [disabled]="!game.canUsePowerUp('laser')" class="p-2 border-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed h-12 flex justify-center items-center" [class]="game.canUsePowerUp('laser') ? 'border-red-500 text-red-500 hover:bg-red-500/20' : 'border-slate-600 text-slate-600'">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" /></svg>
                </button>
                <button (click)="game.activatePowerUp('slow')" [disabled]="!game.canUsePowerUp('slow')" class="p-2 border-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed h-12 flex justify-center items-center" [class]="game.canUsePowerUp('slow') ? 'border-blue-500 text-blue-500 hover:bg-blue-500/20' : 'border-slate-600 text-slate-600'">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                </button>
                <button (click)="game.activatePowerUp('mutate')" [disabled]="!game.canUsePowerUp('mutate')" class="p-2 border-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed h-12 flex justify-center items-center" [class]="game.canUsePowerUp('mutate') ? 'border-purple-500 text-purple-500 hover:bg-purple-500/20' : 'border-slate-600 text-slate-600'">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.5 21.75l-.398-1.188a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.188-.398a2.25 2.25 0 001.423-1.423L16.5 15.75l.398 1.188a2.25 2.25 0 001.423 1.423L19.5 18.75l-1.188.398a2.25 2.25 0 00-1.423 1.423z" /></svg>
                </button>
                <button (click)="game.activatePowerUp('aimer')" [disabled]="!game.canUsePowerUp('aimer')" class="p-2 border-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed h-12 flex justify-center items-center" [class]="game.canUsePowerUp('aimer') ? 'border-yellow-500 text-yellow-500 hover:bg-yellow-500/20' : 'border-slate-600 text-slate-600'">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" /></svg>
                </button>
            </div>
        </app-info-panel>
      </div>

      <!-- Game Board & Overlay -->
      <div class="relative shadow-2xl shadow-cyan-500/20 border-4 border-slate-700 rounded-lg">
        <app-board 
            [board]="game.board()" 
            [currentPiece]="game.currentPiece()" 
            [ghostPiece]="game.ghostPiece()"
            [animationMode]="game.animationMode()"
            [dropProgress]="game.dropProgress()"
            [cellSize]="cellSize()"
             />
        <app-game-overlay 
            [gameState]="game.gameState()"
            [countdownValue]="game.countdownValue()"
            [animationMode]="game.animationMode()"
            (startEvent)="game.startGame()"
            (restart)="game.startGame()"
            (togglePause)="game.togglePause()"
            (toggleAnimation)="game.toggleAnimationMode()"
             />
      </div>
    </div>

    <!-- Right Column -->
    <div class="flex flex-col" [style.width.px]="boardWidth() / 3">
      
      <!-- Combined Info Panel -->
      <div class="w-full">
        <app-info-panel>
            <div class="flex flex-col justify-around items-center gap-4 py-2">
                <div class="flex flex-col items-center">
                    <h4 class="text-xs text-slate-400 mb-2 uppercase">Hold</h4>
                    @if (game.holdPiece(); as piece) {
                        <app-piece-preview [piece]="piece.shape" />
                    } @else {
                        <div class="w-16 h-12 flex items-center justify-center text-slate-600 text-xs rounded-md bg-slate-900/50">Empty</div>
                    }
                </div>
                <div class="flex flex-col items-center">
                    <h4 class="text-xs text-slate-400 mb-2 uppercase">Next</h4>
                    @if (game.nextPiece(); as piece) {
                        <app-piece-preview [piece]="piece.shape" />
                    } @else {
                        <div class="w-16 h-12 flex items-center justify-center text-slate-600 text-xs rounded-md bg-slate-900/50">Empty</div>
                    }
                </div>
                 <div class="flex flex-col items-center">
                      <h4 class="text-xs text-slate-400 mb-2 uppercase">Score</h4>
                      <p class="text-base lg:text-xl text-yellow-300">{{ game.score() }}</p>
                  </div>
                  <div class="flex flex-col items-center">
                      <h4 class="text-xs text-slate-400 mb-2 uppercase">Level</h4>
                      <p class="text-base lg:text-xl text-green-400">{{ game.level() }}</p>
                  </div>
                  <div class="flex flex-col items-center">
                      <h4 class="text-xs text-slate-400 mb-2 uppercase">Lines</h4>
                      <p class="text-base lg:text-xl text-purple-400">{{ game.linesCleared() }}</p>
                  </div>
            </div>
        </app-info-panel>
      </div>

      <!-- Spacer -->
      <div class="flex-grow"></div>

      <!-- Instructions -->
      <div class="w-full">
        <app-instructions [isDesktop]="isDesktop()" />
      </div>

      <!-- Mobile Controls: Only visible on mobile -->
      @if (!isDesktop()) {
        <div class="w-full">
            <app-info-panel>
                <div class="grid grid-cols-3 gap-2 text-center">
                  @for (control of mobileControls; track control.label) {
                    <button
                      (click)="control.action()"
                      [disabled]="control.disabled()"
                      class="p-2 border-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed h-12 flex justify-center items-center border-slate-600 text-slate-300">
                      {{ control.label }}
                    </button>
                  }
                </div>
            </app-info-panel>
        </div>
      }
      
    </div>
  </div>
</div>